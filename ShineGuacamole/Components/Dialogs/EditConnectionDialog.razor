@using ShineGuacamole.Client.Pages
@using System.Text.RegularExpressions
@using System.ComponentModel.DataAnnotations
@using ShineGuacamole.Client.Components
@using ShineGuacamole.Client.Shared

@rendermode RenderMode.InteractiveServer

@inherits ShineComponentBase<EditConnectionDialog>

<MudDialog>
    <TitleContent>
        @(string.IsNullOrEmpty(ConnectionId) ? "Add Connection" : "Update Connection")
    </TitleContent>
    <DialogContent>
        @if (_isLoading)
        {
            <LoadingComponent />
        }
        else if (_connection != null && _properties != null)
        {
            <MudForm @ref="form">                
                <MudStack Style="min-width: 25rem;">
                    <MudPaper Outlined="true" Class="pa-4">
                        <MudTextField T="string" Label="Name"
                                      Variant="Variant.Outlined"
                                      Margin="Margin.Dense"
                                      @bind-Value="_connection.Name"
                                      Required="true" RequiredError="Name is required!" />
                        <MudFileUpload T="IBrowserFile" FilesChanged="UploadImage">
                            <ActivatorContent>
                                <MudStack Row="true" AlignItems="AlignItems.Center" Class="mt-3">
                                    <MudText>Image</MudText>
                                    <MudFab Color="Color.Primary" Size="Size.Small"
                                            StartIcon="@Icons.Material.Filled.Image"
                                            Label="Select File" />
                                    @if (_connection.Image != null)
                                    {
                                        <MudLink OnClick="RemoveImage"><MudIcon Icon="@Icons.Material.Filled.Clear" /></MudLink>
                                    }
                                </MudStack>
                            </ActivatorContent>
                        </MudFileUpload>
                    </MudPaper>
                    <MudPaper Outlined="true" Class="pa-4 mb-3">
                        <MudTextField T="string" Label="Hostname"
                                      Variant="Variant.Outlined"
                                      Margin="Margin.Dense"
                                      @bind-Value="_properties.Hostname"
                                      Required="true" RequiredError="Hostname is required!" />
                        <MudTextField T="string" Label="Username"
                                      Variant="Variant.Outlined"
                                      Margin="Margin.Dense"
                                      @bind-Value="_properties.Username"
                                      Required="true" RequiredError="Username is required!" />
                        <MudTextField T="string" Label="Password"
                                      Variant="Variant.Outlined"
                                      Margin="Margin.Dense"
                                      @bind-Value="_properties.Password"
                                      InputType="InputType.Password" />
                        <MudTextField T="string" Label="Remote App"
                                      Variant="Variant.Outlined"
                                      Margin="Margin.Dense"
                                      @bind-Value="_properties.RemoteApp"
                                      HelperText="e.g. ||wmplayer" />
                    </MudPaper>            
                </MudStack>
            </MudForm>
        }
        else
        {
            <ErrorMessage Height="5rem" Message="Nothing to show here!"></ErrorMessage>
        }
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" DropShadow="false" OnClick="@(() => SaveConnection())">Save</MudButton>
        <MudButton Variant="Variant.Filled" Color="Color.Secondary" DropShadow="false" OnClick="@(() => form.ResetAsync())" Class="mx-2">Reset</MudButton>
    </DialogActions>
</MudDialog>
